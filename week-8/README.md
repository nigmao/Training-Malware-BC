# System Programming

## [1]. Lý thuyết:

- Nghiên cứu, tìm hiểu các IDE hỗ trợ lập trình C trên Linux. Viết tài liệu & lựa chọn IDE phù hợp nhất.

- Tìm hiểu các khái niệm uid, euid, own, mod.

  - https://en.wikipedia.org/wiki/Setuid
  - https://viblo.asia/p/chmod-777-no-thuc-su-nghia-la-gi-E375zw4JKGW

- `1.` Dưới đây là giải thích về các khái niệm uid, euid, owner (chủ sở hữu) và mod (permissions mode) trong hệ thống Unix và Unix-like:

1. **UID (User Identifier - Định danh Người dùng):**

   - UID là một số duy nhất được gán cho mỗi người dùng trên hệ thống Unix.
   - Mỗi người dùng sẽ có một UID duy nhất, giúp hệ thống nhận biết và quản lý quyền của từng người dùng.

2. **EUID (Effective User Identifier - Định danh Người dùng Hiệu quả):**

   - EUID là một số nguyên đại diện cho quyền hạn hiệu quả của quá trình đang thực thi.
   - Khi một quá trình được thực thi, EUID thường bằng với UID của người dùng chạy quá trình. Tuy nhiên, nếu quá trình có quyền SUID (SetUID), EUID có thể được thay đổi thành chủ sở hữu của tệp thực thi.

3. **Owner (Chủ sở hữu):**

   - Chủ sở hữu của một tệp (file) hoặc thư mục (directory) là người dùng hoặc nhóm người dùng mà tệp hoặc thư mục đó thuộc về.
   - Chủ sở hữu có quyền kiểm soát quyền truy cập và thực thi của tệp hoặc thư mục đó.

4. **Mod (Permissions Mode - Chế độ quyền):**
   - Mod định nghĩa quyền truy cập cho người chủ sở hữu (owner), nhóm người dùng (group) và người dùng khác (other) đối với một tệp hoặc thư mục.
   - Các quyền được biểu diễn bằng ba nhóm của ba chữ cái (r - read, w - write, x - execute), mỗi nhóm có thể được cấp quyền hoặc bị cấm.

- Ví dụ, nếu bạn nhìn vào đầu ra của lệnh `ls -l` trên Unix-like system, bạn sẽ thấy thông tin về chủ sở hữu, nhóm người dùng, quyền của người chủ sở hữu, nhóm người dùng, và người dùng khác đối với một tệp hoặc thư mục cụ thể.

- `2.` Đặt suid có nghĩa là khiến cho khi ai đó chạy chương trình, nó sẽ chạy với quyền của chủ sở hữu (user) của chương trình thay vì với quyền của người chạy nó. Điều này hữu ích trong trường hợp bạn muốn chạy một chương trình với quyền đặc quyền mà không cần phải đăng nhập với tài khoản có quyền đó.

  - Khi nói về SUID (Set User ID), chúng ta thường thấy con số được sử dụng trong lệnh `chmod`. Hãy giải thích về các con số và khái niệm này.

1. **Quyền Truy Cập Cơ Bản:**

   - Trong hệ thống Unix, mỗi tệp tin và thư mục có quyền truy cập được xác định bằng ba nhóm quyền: quyền của người chủ sở hữu (owner), quyền của nhóm người dùng (group) và quyền của người dùng khác (others).

2. **Biểu Diễn Số Hóa:**

   - Các quyền truy cập này được biểu diễn dưới dạng số hóa trong hệ thống Unix, thường là một con số 3 chữ số.

3. **Các Quyền Cơ Bản:**

   - Mỗi chữ số trong con số biểu diễn quyền của một nhóm: Read (R - 4), Write (W - 2), Execute (X - 1). Các chữ số này được cộng lại để tạo ra con số biểu diễn quyền truy cập.
   - Ví dụ, 7 biểu thị quyền đọc (4) + quyền ghi (2) + quyền thực thi (1).

4. **Bit SUID (Set User ID):**

   - Bit SUID được biểu diễn bằng số 4 (1000). Khi tệp tin hoặc thư mục có bit SUID được đặt, nó sẽ chạy với quyền của người chủ sở hữu khi được thực thi.

5. **Cách Biểu Diễn SUID trong lệnh chmod:**

   - Khi bạn muốn đặt bit SUID cho một tệp tin, bạn thêm số 4xxx vào lệnh `chmod`. Số 4 ở đây đại diện cho bit SUID. Ví dụ, để đặt bit SUID và quyền đọc, ghi và thực thi cho người chủ sở hữu, bạn có thể sử dụng `chmod 4755`.

6. **Ví dụ Sử Dụng SUID:**
   - Chương trình `passwd` thường được thiết lập với bit SUID để người dùng có thể thay đổi mật khẩu của mình mà không cần quyền root.

## [2]. Thực hành:

- `Bài-01 (2đ)`: Sử dụng ngôn ngữ lập trình C/C++ trên môi trường Ubuntu, xây dựng chương trình Set password cho 1 user bất kỳ bằng quyền người dùng thường.

  - Chương trình chạy lệnh passwd [tham số tên user] rồi set suid xem có thể xây dựng chương trình Set password cho 1 user bất kỳ bằng quyền người dùng thường.

Để đặt bit SUID cho chương trình set password:

1. **Biên Dịch Chương Trình:**

   ```bash
   gcc set_password.c -o set_password
   ls -al
   ```

2. **Thiết Lập Bit SUID:**

   - Sử dụng lệnh `chmod` để đặt bit SUID cho chương trình:

     ```bash
     sudo chown root:root set_password
     ```

     ```bash
     sudo chmod u+x set_password
     ```

     ```bash
     sudo chmod u+s set_password
     ```

3. **Thiết Lập Quyền Đối Với Lệnh `passwd`:**

   - Mở file sudoers để chỉnh sửa:
     ```bash
     sudo visudo
     ```
   - Thêm dòng sau vào file và lưu lại:
     ```
     %sudo ALL=(ALL) NOPASSWD: /usr/bin/passwd
     ```

4. **Thực Hiện Kiểm Tra:**
   - Chạy chương trình và kiểm tra xem bit SUID đã được đặt hay chưa:
     ```bash
     ls -l set_password
     ```
     Bạn sẽ thấy một ký tự `s` ở giữa quyền thực thi và quyền của người chủ sở hữu, đại diện cho bit SUID.

- `Bài-02 (4đ)`: Sử dụng ngôn ngữ lập trình C/C++ trên môi trường Ubuntu, xây dựng chương trình: Có 2 user thường, chạy tiến trình bằng quyền user 1 nhưng thực hiện lệnh id thì in ra thông tin user 2.

  - Biên dịch chương trình này với gcc: `gcc run_id.c -o run_id`, check quyền `ls -al` sau đó thực hiện các bước sau với quyền root:

    - 1. Đặt chủ sở hữu của tệp thực thi là user 2: `sudo chown user2:user2 run_id`
    - 2. Đặt bit SUID cho tệp thực thi: `sudo chmod u+x run_id`, `sudo chmod u+s run_id`

  - Bây giờ, khi user 1 chạy chương trình `./run_id`, chương trình sẽ chạy với quyền của user 2, và lệnh `id` sẽ in ra thông tin của user 2.

- Output:
  - File tài liệu ghi lại các nội dung quan trọng đã nghiên cứu.
  - Mã nguồn và file thực thi đã biên dịch. Lập trình rõ ràng, sạch đẹp (coding convention chuẩn).
  - Bốc thăm trình bày về System Programming (có slide).

## [3]. References:

- https://en.wikipedia.org/wiki/Sticky_bit
- https://en.wikipedia.org/wiki/Setuid
- Google
